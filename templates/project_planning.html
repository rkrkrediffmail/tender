{% extends "base.html" %}

{% block title %}Project Planning - AI Tender Analysis System{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0">Project Planning</h1>
                    <p class="text-muted">AI-generated project timeline and resource allocation</p>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-primary">
                        <i class="fas fa-sync me-2"></i>Regenerate Plan
                    </button>
                    <button class="btn btn-outline-secondary">
                        <i class="fas fa-download me-2"></i>Export Schedule
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Overview Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <h3>18</h3>
                    <p class="mb-0">Total Weeks</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <h3>127</h3>
                    <p class="mb-0">Total Tasks</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body text-center">
                    <h3>12</h3>
                    <p class="mb-0">Team Members</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body text-center">
                    <h3>5</h3>
                    <p class="mb-0">Critical Path Items</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Timeline View -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-calendar-alt me-2"></i>Project Timeline
                        </h5>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm active">Gantt</button>
                            <button type="button" class="btn btn-outline-primary btn-sm">Kanban</button>
                            <button type="button" class="btn btn-outline-primary btn-sm">Calendar</button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="timeline-container">
                        <!-- Timeline Header -->
                        <div class="timeline-header">
                            <div class="timeline-months">
                                <div class="month">Jan 2025</div>
                                <div class="month">Feb 2025</div>
                                <div class="month">Mar 2025</div>
                                <div class="month">Apr 2025</div>
                                <div class="month">May 2025</div>
                            </div>
                        </div>

                        <!-- Timeline Body -->
                        <div class="timeline-body">
                            <!-- Phase 1: Analysis & Requirements -->
                            <div class="timeline-phase analysis-phase">
                                <div class="phase-header">
                                    <h6><i class="fas fa-search me-2"></i>Phase 1: Analysis & Requirements</h6>
                                    <span class="badge bg-primary">4 weeks</span>
                                </div>
                                <div class="timeline-tasks">
                                    <div class="timeline-task critical">
                                        <div class="task-bar" style="width: 20%; left: 0%;">
                                            <span class="task-name">Document Analysis</span>
                                            <span class="task-duration">2 weeks</span>
                                        </div>
                                    </div>
                                    <div class="timeline-task">
                                        <div class="task-bar" style="width: 15%; left: 10%;">
                                            <span class="task-name">Requirements Gathering</span>
                                            <span class="task-duration">1.5 weeks</span>
                                        </div>
                                    </div>
                                    <div class="timeline-task">
                                        <div class="task-bar" style="width: 12%; left: 18%;">
                                            <span class="task-name">Risk Assessment</span>
                                            <span class="task-duration">1 week</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Phase 2: Solution Design -->
                            <div class="timeline-phase solution-phase">
                                <div class="phase-header">
                                    <h6><i class="fas fa-cogs me-2"></i>Phase 2: Solution Design</h6>
                                    <span class="badge bg-success">6 weeks</span>
                                </div>
                                <div class="timeline-tasks">
                                    <div class="timeline-task critical">
                                        <div class="task-bar" style="width: 25%; left: 20%;">
                                            <span class="task-name">Architecture Design</span>
                                            <span class="task-duration">3 weeks</span>
                                        </div>
                                    </div>
                                    <div class="timeline-task">
                                        <div class="task-bar" style="width: 20%; left: 30%;">
                                            <span class="task-name">Technical Specifications</span>
                                            <span class="task-duration">2.5 weeks</span>
                                        </div>
                                    </div>
                                    <div class="timeline-task">
                                        <div class="task-bar" style="width: 15%; left: 35%;">
                                            <span class="task-name">Integration Planning</span>
                                            <span class="task-duration">2 weeks</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Phase 3: Development -->
                            <div class="timeline-phase delivery-phase">
                                <div class="phase-header">
                                    <h6><i class="fas fa-code me-2"></i>Phase 3: Development</h6>
                                    <span class="badge bg-warning">8 weeks</span>
                                </div>
                                <div class="timeline-tasks">
                                    <div class="timeline-task">
                                        <div class="task-bar" style="width: 30%; left: 45%;">
                                            <span class="task-name">Core Development</span>
                                            <span class="task-duration">6 weeks</span>
                                        </div>
                                    </div>
                                    <div class="timeline-task">
                                        <div class="task-bar" style="width: 20%; left: 55%;">
                                            <span class="task-name">Integration Testing</span>
                                            <span class="task-duration">3 weeks</span>
                                        </div>
                                    </div>
                                    <div class="timeline-task critical">
                                        <div class="task-bar" style="width: 15%; left: 70%;">
                                            <span class="task-name">Security Testing</span>
                                            <span class="task-duration">2 weeks</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Critical Path Indicator -->
                            <div class="critical-path">
                                <div class="critical-line" style="width: 85%;"></div>
                                <span class="critical-label">Critical Path</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resource Allocation -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-users me-2"></i>Resource Allocation
                    </h5>
                </div>
                <div class="card-body">
                    <div class="resource-chart">
                        <canvas id="resourceChart" height="300"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Planning Agent & Details -->
        <div class="col-md-4">
            <!-- Project Planning Agent -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-robot me-2"></i>Project Planning Agent
                    </h5>
                </div>
                <div class="card-body">
                    <div class="agent-status">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="badge bg-success">
                                <i class="fas fa-circle me-1"></i>Active
                            </span>
                            <small class="text-muted">o1 Reasoning Model</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label small">Planning Progress</label>
                            <div class="progress">
                                <div class="progress-bar bg-success" style="width: 87%"></div>
                            </div>
                            <small class="text-muted">87% Complete</small>
                        </div>

                        <div class="planning-insights">
                            <h6 class="small mb-2">Optimization Results:</h6>
                            <ul class="list-unstyled small">
                                <li><i class="fas fa-check text-success me-2"></i>Multi-constraint optimization applied</li>
                                <li><i class="fas fa-check text-success me-2"></i>Resource conflicts resolved</li>
                                <li><i class="fas fa-check text-success me-2"></i>Critical path identified</li>
                                <li><i class="fas fa-exclamation-triangle text-warning me-2"></i>2 high-risk dependencies found</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Milestones -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-flag me-2"></i>Key Milestones
                    </h5>
                </div>
                <div class="card-body">
                    <div class="milestone-list">
                        <div class="milestone-item completed">
                            <div class="milestone-date">Feb 15</div>
                            <div class="milestone-info">
                                <h6>Requirements Sign-off</h6>
                                <small class="text-success">Completed</small>
                            </div>
                            <div class="milestone-status">
                                <i class="fas fa-check-circle text-success"></i>
                            </div>
                        </div>

                        <div class="milestone-item current">
                            <div class="milestone-date">Mar 01</div>
                            <div class="milestone-info">
                                <h6>Architecture Review</h6>
                                <small class="text-primary">In Progress</small>
                            </div>
                            <div class="milestone-status">
                                <i class="fas fa-spinner fa-spin text-primary"></i>
                            </div>
                        </div>

                        <div class="milestone-item">
                            <div class="milestone-date">Mar 15</div>
                            <div class="milestone-info">
                                <h6>Development Kickoff</h6>
                                <small class="text-muted">Pending</small>
                            </div>
                            <div class="milestone-status">
                                <i class="fas fa-clock text-muted"></i>
                            </div>
                        </div>

                        <div class="milestone-item">
                            <div class="milestone-date">Apr 30</div>
                            <div class="milestone-info">
                                <h6>Alpha Release</h6>
                                <small class="text-muted">Scheduled</small>
                            </div>
                            <div class="milestone-status">
                                <i class="fas fa-calendar text-muted"></i>
                            </div>
                        </div>

                        <div class="milestone-item critical">
                            <div class="milestone-date">May 15</div>
                            <div class="milestone-info">
                                <h6>Production Deployment</h6>
                                <small class="text-danger">Critical</small>
                            </div>
                            <div class="milestone-status">
                                <i class="fas fa-exclamation-triangle text-danger"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Timeline -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>Risk Timeline
                    </h5>
                </div>
                <div class="card-body">
                    <div class="risk-timeline">
                        <div class="risk-item high">
                            <div class="risk-indicator"></div>
                            <div class="risk-content">
                                <h6>Integration Complexity</h6>
                                <small>Week 8-10 • High Risk</small>
                                <div class="risk-mitigation">
                                    <small class="text-muted">Mitigation: Early prototype testing</small>
                                </div>
                            </div>
                        </div>

                        <div class="risk-item medium">
                            <div class="risk-indicator"></div>
                            <div class="risk-content">
                                <h6>Resource Availability</h6>
                                <small>Week 12-14 • Medium Risk</small>
                                <div class="risk-mitigation">
                                    <small class="text-muted">Mitigation: Cross-training plan</small>
                                </div>
                            </div>
                        </div>

                        <div class="risk-item low">
                            <div class="risk-indicator"></div>
                            <div class="risk-content">
                                <h6>Third-party Dependencies</h6>
                                <small>Week 15-16 • Low Risk</small>
                                <div class="risk-mitigation">
                                    <small class="text-muted">Mitigation: Fallback options identified</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-bolt me-2"></i>Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary">
                            <i class="fas fa-optimize me-2"></i>Optimize Schedule
                        </button>
                        <button class="btn btn-outline-secondary">
                            <i class="fas fa-balance-scale me-2"></i>Resource Leveling
                        </button>
                        <button class="btn btn-outline-info">
                            <i class="fas fa-share me-2"></i>Share Timeline
                        </button>
                        <button class="btn btn-outline-warning">
                            <i class="fas fa-exclamation me-2"></i>Update Risks
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Resource allocation chart
    const ctx = document.getElementById('resourceChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Week 1', 'Week 4', 'Week 8', 'Week 12', 'Week 16', 'Week 18'],
            datasets: [
                {
                    label: 'Developers',
                    data: [3, 6, 8, 6, 4, 2],
                    borderColor: '#0d6efd',
                    backgroundColor: 'rgba(13, 110, 253, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'Architects',
                    data: [2, 3, 2, 1, 1, 1],
                    borderColor: '#198754',
                    backgroundColor: 'rgba(25, 135, 84, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'QA Engineers',
                    data: [0, 1, 3, 4, 3, 2],
                    borderColor: '#ffc107',
                    backgroundColor: 'rgba(255, 193, 7, 0.1)',
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 10
                }
            }
        }
    });

    // Timeline interactions
    document.querySelectorAll('.task-bar').forEach(bar => {
        bar.addEventListener('click', function() {
            console.log('Task clicked:', this.querySelector('.task-name').textContent);
        });
    });
</script>
{% endblock %}
